<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title></title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- css -->
<link rel="stylesheet" type="text/css" href="/javascripts/yui/build/autocomplete/assets/skins/sam/autocomplete.css">
<link rel="stylesheet" type="text/css" href="/javascripts/yui/build/button/assets/skins/sam/button.css">
<link rel="stylesheet" type="text/css" href="/javascripts/yui/build/calendar/assets/skins/sam/calendar.css">
<link rel="stylesheet" type="text/css" href="/javascripts/yui/build/colorpicker/assets/skins/sam/colorpicker.css">
<link rel="stylesheet" type="text/css" href="/javascripts/yui/build/container/assets/skins/sam/container.css">
<link rel="stylesheet" type="text/css" href="/javascripts/yui/build/datatable/assets/skins/sam/datatable.css">
<link rel="stylesheet" type="text/css" href="/javascripts/yui/build/logger/assets/skins/sam/logger.css">
<link rel="stylesheet" type="text/css" href="/javascripts/yui/build/yuitest/assets/skins/sam/yuitest.css">
<link rel="stylesheet" type="text/css" href="/javascripts/yui/build/fonts/fonts-min.css">
<link rel="stylesheet" type="text/css" href="/javascripts/yui/build/reset/reset-min.css">
<link rel="stylesheet" type="text/css" href="/javascripts/yui/build/grids/grids-min.css">
<link rel="stylesheet" type="text/css" href="/javascripts/yui/build/base/base-min.css">
<!-- js -->
<script type="text/javascript" src="/javascripts/yui/build/yahoo/yahoo-min.js"></script>
<script type="text/javascript" src="/javascripts/yui/build/dom/dom-min.js"></script>
<script type="text/javascript" src="/javascripts/yui/build/event/event-min.js"></script>
<script type="text/javascript" src="/javascripts/yui/build/animation/animation-min.js"></script>
<script type="text/javascript" src="/javascripts/yui/build/connection/connection-min.js"></script>
<script type="text/javascript" src="/javascripts/yui/build/autocomplete/autocomplete-min.js"></script>
<script type="text/javascript" src="/javascripts/yui/build/element/element-beta-min.js"></script>
<script type="text/javascript" src="/javascripts/yui/build/button/button-min.js"></script>
<script type="text/javascript" src="/javascripts/yui/build/calendar/calendar-min.js"></script>
<script type="text/javascript" src="/javascripts/yui/build/datasource/datasource-beta-min.js"></script>
<script type="text/javascript" src="/javascripts/yui/build/json/json-min.js"></script>
<script type="text/javascript" src="/javascripts/yui/build/charts/charts-experimental-min.js"></script>
<script type="text/javascript" src="/javascripts/yui/build/dragdrop/dragdrop-min.js"></script>
<script type="text/javascript" src="/javascripts/yui/build/slider/slider-min.js"></script>
<script type="text/javascript" src="/javascripts/yui/build/colorpicker/colorpicker-min.js"></script>
<script type="text/javascript" src="/javascripts/yui/build/container/container-min.js"></script>
<script type="text/javascript" src="/javascripts/yui/build/cookie/cookie-beta-min.js"></script>
<script type="text/javascript" src="/javascripts/yui/build/datatable/datatable-beta-min.js"></script>
<script type="text/javascript" src="/javascripts/yui/build/logger/logger-min.js"></script>
<script type="text/javascript" src="/javascripts/yui/build/yuitest/yuitest-min.js"></script>
<!--development_css_js-->

<script type="text/javascript" src="/javascripts/uuid.js"></script>
<script type="text/javascript" src="/javascripts/myutils/string.js"></script>
</head>

<body class="yui-skin-sam">

<div id="doc" class="yui-t7">
   <div id="hd"><h1>FengHua Foreign Affairs Office</h1></div>
   <div id="bd">
	<div class="yui-g">
	<!-- YOUR DATA GOES HERE -->

<style>
    form label { display:block;float:left;width:45%;clear:left; }
    .clear { clear:both; }
</style>

<div id="addStaffDialog">
<div class="hd">请输入人员信息：</div>
<div class="bd">
<form method="POST" action="assets/post.php">
        <input type="hidden" name="id" value="" id="id_sf_dlg" />
	<label for="name">名字：</label><input type="textbox" name="name" id="name_sf_dlg" />
        <label for="danwei">单位：</label><input type="textbox" name="danwei" id="danwei_sf_dlg"/>
        <label for="zhiwu">职务：</label><input type="textbox" name="zhiwu" id="zhiwu_sf_dlg"/>
        <label for="hzhaoma">护照：</label><input type="textbox" name="hzhaoma" id="hzhaoma_sf_dlg"/>
        <label for="hzghriqi">归还日期：</label><input type="textbox" name="hzghriqi" id="hzghriqi_sf_dlg"/>
        <label for="pyname">名字拼音：</label><input type="textbox" name="pyname" id="pyname_sf_dlg"/>
        <label for="spyname">名字短拼音：</label><input type="textbox" name="spyname" id="spyname_sf_dlg"/>
        <label for="birthday">生日（年龄）：</label><input type="textbox" name="birthday" id="birthday_sf_dlg"/>
	<div class="clear"></div>
	<label for="sex">性别：</label><input type="checkbox" name="sex" value="1" id="sex_sf_dlg"/> 女
	<div class="clear"></div>
	<label for="note">备注：</label><textarea name="note" id="note_sf_dlg"></textarea>
	<div class="clear"></div>
</form>
</div>
</div>

<div id="addStaffdDialog">
<div class="hd">请输入人员信息：</div>
<div class="bd">
<form method="POST" action="assets/post.php">
        <input type="hidden" name="id" value="" id="id_sfd_dlg" />
	<label for="name">名字：</label><input type="textbox" name="name" id="name_sfd_dlg" />
        <label for="danwei">单位：</label><input type="textbox" name="danwei" id="danwei_sfd_dlg"/>
        <label for="zhiwu">职务：</label><input type="textbox" name="zhiwu" id="zhiwu_sfd_dlg"/>
        <label for="hzhaoma">护照：</label><input type="textbox" name="hzhaoma" id="hzhaoma_sfd_dlg"/>
        <label for="hzghriqi">归还日期：</label><input type="textbox" name="hzghriqi" id="hzghriqi_sfd_dlg"/>
	<div class="clear"></div>
	<label for="isreturned">护照是否归还：</label><input type="checkbox" name="isreturned" value="1" id="isreturned_sfd_dlg"/> 已归还
	<div class="clear"></div>
	<label for="note">备注：</label><textarea name="note" id="note_sfd_dlg"></textarea>
	<div class="clear"></div>
</form>
</div>
</div>


<div id="addActivityDialog">
<div class="hd">请输入人员信息：</div>
<div class="bd">
<form method="POST" action="assets/post.php">
        <input type="hidden" name="id" value="" id="id_ay_dlg">
	<label for="sqriqi">申请日期：</label><input type="textbox" name="sqriqi" id="sqriqi_ay_dlg"/>
        <label for="dguojia">出访国家：</label><input type="textbox" name="dguojia" id="dguojia_ay_dlg" />
        <label for="renwu">出访任务：</label><textarea name="renwu" id="renwu_ay_dlg"></textarea>
        <label for="cfshijian">出访时间：</label><input type="textbox" name="cfshijian"  id="cfshijian_ay_dlg"/>
        <label for="tltianshu">停留天数：</label><input type="textbox" name="tltianshu" id="tltianshu_ay_dlg" />
        <label for="ztdanwei">组团单位：</label><input type="textbox" name="ztdanwei" id="ztdanwei_ay_dlg" />
        <label for="yqdanwei">邀请单位：</label><input type="textbox" name="yqdanwei" id="yqdanwei_ay_dlg" />
        <label for="rwpihao">任务批号：</label><input type="textbox" name="rwpihao" id="rwpihao_ay_dlg" />
        <div class="clear"></div>
        <label for="note">备注：</label><textarea name="note" id="note_ay_dlg"></textarea>
	<div class="clear"></div>
</form>
</div>
</div>

<br/>

<style type="text/css">
    #autocomplete {
        height: 25px;
    }
    #ac_input {
        position: static;
        width: 300px;
    }
    #dt_ac_container {
        display: none;
    }
</style>

<div id="autocomplete">
   <input id="ac_input" type="text" value=""/>
    <div id="dt_ac_container"></div>
</div>

<div id="radiogroup1" class="yui-buttongroup">
    <input id="staff_radio" type="radio" name="radiofield1" value="1" checked>人员查询
    <input id="activity_radio" type="radio" name="radiofield1" value="2">出访查询
</div>

<br/>
<div id="staff_tab">
<button id="addStaffBtn">添加人员</button>
<div id="staffDataTable"></div>
</div>

<div id="activity_tab"  style="display:none">
<button id="addActivityBtn">添加出访任务</button>
<div id="ActivityDataTable"></div>
</div>

<div id="staff_panel_container">
  	<div id="staff_panel">
		<div class="hd">Panel #1 from Markup &mdash; This Panel is Draggable</div>
		<div class="bd"><div id="staffdDataTable"></div></div>
		<div class="ft">End of Panel #1</div>
	</div>
</div>

<div id="test_button">test button</div>

<script type="text/javascript">
    var Dom = YAHOO.util.Dom;
    var Event = YAHOO.util.Event;
    var fao = YAHOO.namespace("fao");
    fao.doms = {
      activity_tab : Dom.get("activity_tab"),
      staff_tab : Dom.get("staff_tab"),
      staff_radio : Dom.get("staff_radio"),
      activity_radio : Dom.get("activity_radio"),
      ac_input:Dom.get("ac_input"),
      staff_panel_tab : Dom.get("staff_panel_container")
    };
    fao.variables = {
      cur_table : 1,
      db : null,
      activity_id : null,
      pre_staff_phase : "",
      pre_activity_phase : ""
//      pre_staff_page : 1,
//      pre_activity_page : 1
    };
    fao.utils = {
      convertDate : function(date_str){
        var ymd = /(\d{4})[^\d](\d{1,2})[^\d](\d{1,2})/;
        var result = date_str.match(ymd);
        if(result){
            var date = new Date(result[1],result[2],result[3],1,1,1,1);
            return date.getTime();
        }
        else{
            return 0;
        }
      },
      convertAge : function(nDatetimes){
          var date = new Date(nDatetimes);
          var thisyear = new Date();
          return(thisyear.getFullYear() - date.getFullYear());
      },
      formatDate : function(elCell, oRecord, oColumn, oData){
          var date =oData;
          var y = date.getFullYear();
          var m = date.getMonth();
          var d = date.getDate();
          m = m < 10 ? "0"+ m : m;
          d = d < 10 ? "0"+ d : d;
          elCell.innerHTML = y + "-" + m + "-" + d;
      },
      formatDeleteButton : function(el, oRecord, oColumn, oData) {
        el.innerHTML = "<button type=\"button\">删除</button>";
    },
    formatStaffsButton : function(el, oRecord, oColumn, oData) {
        el.innerHTML = "<button type=\"button\">人员</button>";
    }
    };
    fao.classes = {
      Staff : function(data){
        if(!data.id){
            var uuid =new UUID();
            this.id = uuid.id.replace(/-/g,"").toLowerCase();
        }else{
            this.id = data.id;
        }
        this.name = data.name;
        this.danwei = data.danwei,
        this.zhiwu = data.zhiwu,
        this.hzhaoma = data.hzhaoma,
        this.hzghriqi = data.hzghriqi,
        this.pyname = data.pyname;
        this.spyname = data.spyname;
        this.sex = data.sex;
        this.sync_state = 'new';
        this.birthday = fao.utils.convertDate(data.birthday);
        this.note = data.note;
        var curTime = new Date().getTime();
        this.save = function(){
            fao.variables.db.execute("insert into staffs " +
                " (id,name,danwei,zhiwu,hzhaoma,hzghriqi,pyname,spyname,sex,birthday,note,sync_state,created_at,updated_at) " +
                " values (?,?,?,?,?,?,?,?,?,?,?,?,?)",[this.id,this.name,this.danwei,this.zhiwu,this.hzhaoma,this.hzghriqi,this.pyname,this.spyname,this.sex,this.birthday,this.note,this.sync_state,curTime,curTime]);
        };
        this.update = function(){
            fao.variables.db.execute("update staffs set" +
                " name = ?,danwei =?,zhiwu=?,hzhaoma=?,hzghriqi=?,pyname=?,spyname =?,sex=?,birthday=?,note=?,sync_state=?,updated_at=? where id = ?",
            [this.name,this.danwei,this.zhiwu,this.hzhaoma,this.hzghriqi,this.pyname,this.spyname,this.sex,this.birthday,this.note,'changed',curTime,this.id]);
        };
      },
      Activity : function(data){
        if(!data.id){
            var uuid =new UUID();
            this.id = uuid.id.replace(/-/g,"").toLowerCase();
        }else{
            this.id = data.id;
        }

//        var uuid =new UUID();
//        this.id = uuid.id.replace(/-/g,"").toLowerCase();
        this.sqriqi = fao.utils.convertDate(data.sqriqi);
        this.dguojia = data.dguojia;
        this.renwu = data.renwu;
        this.cfshijian = fao.utils.convertDate(data.cfshijian);
        this.tltianshu = data.tltianshu;
        this.ztdanwei = data.ztdanwei;
        this.yqdanwei = data.yqdanwei;
        this.rwpihao = data.rwpihao;
        this.sync_state = 'new';
        this.note = data.note;
        var curTime = new Date().getTime();
        this.save = function(){
            fao.variables.db.execute("insert into activities " +
                " (id,sqriqi,dguojia,renwu,cfshijian,tltianshu,ztdanwei,yqdanwei,rwpihao,note,sync_state,created_at,updated_at) " +
                " values (?,?,?,?,?,?,?,?,?,?,?,?)",[this.id,this.sqriqi,this.dguojia,this.renwu,this.cfshijian,this.tltianshu,this.ztdanwei,this.yqdanwei,this.rwpihao,this.note,this.sync_state,curTime,curTime]);
        };
        this.update = function(){
            fao.variables.db.execute("update activities set " +
                "sqriqi =?,dguojia=?,renwu=?,cfshijian=?,tltianshu=?,ztdanwei=?,yqdanwei=?,rwpihao=?,note=?,sync_state=?,updated_at=? where id=? ",
                [this.sqriqi,this.dguojia,this.renwu,this.cfshijian,this.tltianshu,this.ztdanwei,this.yqdanwei,this.rwpihao,this.note,"changed",curTime,this.id]);
        };

      },
      Staffd : function(data){
        if(!data.id){
            var uuid =new UUID();
            this.id = uuid.id.replace(/-/g,"").toLowerCase();
        }else{
            this.id = data.id;
        }

//        var uuid =new UUID();
//        this.id = uuid.id.replace(/-/g,"").toLowerCase();
        this.staff_id = data.staff_id;
        this.activity_id = data.activity_id;
        this.danwei = data.danwei;
        this.zhiwu = data.zhiwu;
        this.hzhaoma = data.hzhaoma;
        this.hzghriqi = fao.utils.convertDate(data.hzghriqi);
        this.isreturned = data.isreturned;
        this.sync_state = 'new';
        this.note = data.note;
        var curTime = new Date().getTime();
        this.save = function(){
            fao.variables.db.execute("insert into staffds " +
                " (id,staff_id,activity_id,danwei,zhiwu,hzhaoma,hzghriqi,isreturned,note,sync_state,created_at,updated_at) " +
                " values (?,?,?,?,?,?,?,?,?,?,?,?)",[this.id,this.staff_id,this.activity_id,this.danwei,this.zhiwu,this.hzhaoma,this.hzghriqi,this.isreturned,this.note,this.sync_state,curTime,curTime]);
        };
        this.update = function(){
            fao.variables.db.execute("update staffds set " +
                " danwei=?,zhiwu=?,hzhaoma=?,hzghriqi=?,isreturned = ?,note=?,sync_state=?,updated_at=? where id=? ",
                [this.danwei,this.zhiwu,this.hzhaoma,this.hzghriqi,this.isreturned,this.note,'changed',curTime,this.id]);
        };
      }
    };
</script>

<script type="text/javascript"  src="/javascripts/gears_init.js"></script>


<script>
// Open this page's local database.
fao.f = {};
fao.f.my_gear_init = function() {
  if (window.google && google.gears) {
    try {
      fao.variables.db = google.gears.factory.create('beta.database');
      if (fao.variables.db) {
        fao.variables.db.open('database-fao');
        fao.variables.db.execute('create table if not exists staffs' +
                   ' (id varchar(255),' +
                   ' name varchar(255),' +
                   ' danwei varchar(255),' +
                   ' zhiwu varchar(255),' +
                   ' hzhaoma varchar(255),' +
                   ' hzghriqi varchar(255),' +
                   ' pyname varchar(255),' +
                   ' spyname varchar(255),' +
                   ' sex integer,' +
                   ' birthday date,' +
                   ' note text,' + 
                   ' sync_state varchar(255),' +
                   ' created_at datetime,' +
                   ' updated_at datetime,' +
                   ' PRIMARY KEY (id))'
           );

        fao.variables.db.execute('create table if not exists staffds' +
                   ' (id varchar(255),'  +
                   ' staff_id varchar(255),'  +
                   ' activity_id varchar(255),'  +
                   ' danwei varchar(255),' +
                   ' zhiwu varchar(255),' +
                   ' isreturned integer,' +
                   ' note text,' +
                   ' hzhaoma varchar(255),' +
                   ' hzghriqi date,' +
                   ' sync_state varchar(255),' +
                   ' created_at datetime,' +
                   ' updated_at datetime,' +
                   ' PRIMARY KEY (id),' +
                   ' UNIQUE (activity_id, staff_id))'
        );
        fao.variables.db.execute('create table if not exists activities' +
                   ' (id varchar(255),' +
                   ' sqriqi date,' +
                   ' dguojia varchar(255),' +
                   ' renwu text,' +
                   ' cfshijian date,' +
                   ' tltianshu integer,' +
                   ' ztdanwei varchar(255),' +
                   ' yqdanwei varchar(255),' +
                   ' rwpihao varchar(255),' +
                   ' note text,' +
                   ' sync_state varchar(255),' +
                   ' created_at datetime,' +
                   ' updated_at datetime,' +
                   ' PRIMARY KEY (id))'
           );
      }
    } catch (ex) {
      alert(ex.message);
    }
  }
}
</script>

<!--BEGIN SOURCE CODE FOR EXAMPLE =============================== -->

<script>
    fao.classes.DialogStaff = function() {

	// Define various event handlers for Dialog
	var handleSubmit = function() {
            this.submit();
	};
	var handleCancel = function() {
		this.cancel();
	};
        
	var handleSuccess = function(o) {
//            alert("handle success");
	};
	var handleFailure = function(o) {
		alert("Submission failed: " + o.status);
	};

        this.setData = function(oData){
            try{
              Dom.get("id_sf_dlg").value = oData.id;
              Dom.get("name_sf_dlg").value = oData.name;
              Dom.get("danwei_sf_dlg").value = oData.danwei;
              Dom.get("zhiwu_sf_dlg").value = oData.zhiwu;
              Dom.get("hzhaoma_sf_dlg").value = oData.hzhaoma;
              Dom.get("hzghriqi_sf_dlg").value = oData.hzghriqi;
              Dom.get("pyname_sf_dlg").value = oData.pyname;
              Dom.get("spyname_sf_dlg").value = oData.spyname;
              var birthday = oData.birthday;
              Dom.get("birthday_sf_dlg").value = birthday.getFullYear() + "-" + birthday.getMonth() +  "-" + birthday.getDate();
//              alert(oData.birthday instanceof Date);
              Dom.get("sex_sf_dlg").checked = oData.sex;
              Dom.get("note_sf_dlg").value = oData.note;
            }
            catch(e){
                alert(e.message);
            }
        };

	// Instantiate the Dialog
	this.dialog = new YAHOO.widget.Dialog("addStaffDialog",
							{ width : "30em",
                                                          zIndex : 10,
							  fixedcenter : true,
							  visible : false,
							  constraintoviewport : true,
                                                          postmethod: "none",
							  buttons : [ { text:"添加", handler:handleSubmit, isDefault:true },
								      { text:"取消", handler:handleCancel } ]
							});
        this.setButtons = function(){
            this.dialog.cfg.setProperty("buttons",[ { text:"编辑", handler:handleSubmit, isDefault:true },
								      { text:"取消", handler:handleCancel } ]);
        }

	// Validate the entries in the form to require that both first and last name are entered
	this.dialog.validate = function() {
//            alert("validate");
            try{
		var data = this.getData();
		if (data.name == "" || data.pyname =="" || data.spyname == "") {
			alert("请输入完整的资料.");
			return false;
		}
                var ymd = /\d{4}[^\d]\d{1,2}[^\d]\d{1,2}/;
                var result = data.birthday.match(ymd);
                if(!result){
                    alert("日期的格式是：2008-08-08.");
                    return false;
                }else{
                    data.birthday = result[0];
                }
                //save new staff.
//                alert(data.id);
                var staff = new fao.classes.Staff(this.getData());

                if(data.id)
                    staff.update();
                else
                     staff.save();
 
                 fao.variables.staffs_datatable.datasource.sendRequest('', fao.variables.staffs_datatable.datatable.onDataReturnInitializeTable, fao.variables.staffs_datatable.datatable);
                 return true;
            }
            catch(e){
                alert(e.message);
                return false;
            }
	};

	// Wire up the success and failure handlers
	this.dialog.callback = { success: handleSuccess,
						     failure: handleFailure };

	// Render the Dialog
	this.dialog.render();
//        alert(fao.addStaffDialog.cfg.getProperty("postmethod"));
        var addStaffBtnClick = function(){
            Dom.get("id_sf_dlg").value = "";
            this.show();
        };
	Event.addListener("addStaffBtn", "click", addStaffBtnClick, this.dialog, true);
//	Event.addListener("hide", "click", fao.addStaffDialog.hide, fao.addStaffDialog, true);
}
//Event.onDOMReady(init_dialog_staff);
</script>



<script>
    fao.classes.DialogStaffd = function() {

	// Define various event handlers for Dialog
	var handleSubmit = function() {
//            alert("submit");
            this.submit();
	};
	var handleCancel = function() {
		this.cancel();
	};

	var handleSuccess = function(o) {
//            alert("handle success");
	};
	var handleFailure = function(o) {
		alert("Submission failed: " + o.status);
	};

        this.setData = function(oData){
            try{
              Dom.get("id_sfd_dlg").value = oData.id;
              Dom.get("name_sfd_dlg").value = oData.name;
              Dom.get("danwei_sfd_dlg").value = oData.danwei;
              Dom.get("zhiwu_sfd_dlg").value = oData.zhiwu;
              Dom.get("hzhaoma_sfd_dlg").value = oData.hzhaoma;
              var hzghriqi = oData.hzghriqi;
              Dom.get("hzghriqi_sfd_dlg").value = hzghriqi.getFullYear() + "-" + hzghriqi.getMonth() +  "-" + hzghriqi.getDate();
//              alert(oData.birthday instanceof Date);
              Dom.get("isreturned_sfd_dlg").checked = oData.isreturned;
              Dom.get("note_sfd_dlg").value = oData.note;
            }
            catch(e){
                alert(e.message);
//                alert(1);
            }
        };

	// Instantiate the Dialog
	this.dialog = new YAHOO.widget.Dialog("addStaffdDialog",
							{ width : "30em",
                                                          zIndex : 20,
							  fixedcenter : true,
							  visible : false,
							  constraintoviewport : true,
                                                          postmethod: "none",
							  buttons : [ { text:"添加", handler:handleSubmit, isDefault:true },
								      { text:"取消", handler:handleCancel } ]
							});

        this.setButtons = function(){
            this.dialog.cfg.setProperty("buttons",[ { text:"编辑", handler:handleSubmit, isDefault:true },
								      { text:"取消", handler:handleCancel } ]);
        }

	// Validate the entries in the form to require that both first and last name are entered
	this.dialog.validate = function() {
//            alert("validate");
            try{
		var data = this.getData();
		if (data.name == "" || data.pyname =="" || data.spyname == "") {
			alert("请输入完整的资料.");
			return false;
		}
                var ymd = /\d{4}[^\d]\d{1,2}[^\d]\d{1,2}/;
                var result = data.hzghriqi.match(ymd);
                if(!result && data.hzghriqi){
                    alert("日期的格式是：2008-08-08.");
                    return false;
                }else{
                    data.hzghriqi = result[0];
                }
                //save new staff.
//                alert(data.id);
                var staffd = new fao.classes.Staffd(this.getData());
//                alert(data.id);
                if(data.id)
                    staffd.update();
                else
                     staffd.save();
                 fao.variables.staffds_datatable.datasource.sendRequest('', fao.variables.staffds_datatable.datatable.onDataReturnInitializeTable, fao.variables.staffds_datatable.datatable);
                 return true;
            }
            catch(e){
                alert(e.message);
//                alert(2);
                return false;
            }
	};

	// Wire up the success and failure handlers
	this.dialog.callback = { success: handleSuccess,
						     failure: handleFailure };

	// Render the Dialog
	this.dialog.render();
//        alert(fao.addStaffDialog.cfg.getProperty("postmethod"));
//        var addStaffBtnClick = function(){
//            Dom.get("id_sf_dlg").value = "";
//            this.show();
//        };
//	Event.addListener("addStaffBtn", "click", addStaffBtnClick, this.dialog, true);
//	Event.addListener("hide", "click", fao.addStaffDialog.hide, fao.addStaffDialog, true);
}
//Event.onDOMReady(init_dialog_staff);
</script>

<script>
    fao.classes.DialogActivity = function(){
	// Define various event handlers for Dialog
	var handleSubmit = function() {
//            alert("submit");
            this.submit();
	};
	var handleCancel = function() {
		this.cancel();
	};

	var handleSuccess = function(o) {
            alert("handle success");
	};
	var handleFailure = function(o) {
		alert("Submission failed: " + o.status);
	};
        this.setData = function(oData){
            try{
              Dom.get("id_ay_dlg").value = oData.id;
              var sqriqi = oData.sqriqi;
              Dom.get("sqriqi_ay_dlg").value = sqriqi.getFullYear() + "-" + sqriqi.getMonth() +  "-" + sqriqi.getDate();
              Dom.get("dguojia_ay_dlg").value = oData.dguojia;
              Dom.get("renwu_ay_dlg").value = oData.renwu;
              var cfshijian = oData.cfshijian;
              Dom.get("cfshijian_ay_dlg").value = cfshijian.getFullYear() + "-" + cfshijian.getMonth() +  "-" + cfshijian.getDate();
              Dom.get("tltianshu_ay_dlg").value = oData.tltianshu;
              Dom.get("ztdanwei_ay_dlg").value = oData.ztdanwei;
              Dom.get("yqdanwei_ay_dlg").value = oData.yqdanwei;
              Dom.get("rwpihao_ay_dlg").value = oData.rwpihao;
              Dom.get("note_sf_dlg").value = oData.note;
            }
            catch(e){
                alert(e.message);
            }
        };


	// Instantiate the Dialog
	this.dialog = new YAHOO.widget.Dialog("addActivityDialog",
							{ width : "30em",
                                                          zIndex : 10,
							  fixedcenter : true,
							  visible : false,
							  constraintoviewport : true,
                                                          postmethod: "none",
							  buttons : [ { text:"添加", handler:handleSubmit, isDefault:true },
								      { text:"取消", handler:handleCancel } ]
							});

        this.setButtons = function(){
            this.dialog.cfg.setProperty("buttons",[ { text:"编辑", handler:handleSubmit, isDefault:true },
								      { text:"取消", handler:handleCancel } ]);
        }

	// Validate the entries in the form to require that both first and last name are entered

	this.dialog.validate = function() {
//            alert("validate");

            try{
		var data = this.getData();
//                alert(data.sqriqi);
		if (data.dguojia == "") {
			alert("请输入完整的资料.");
			return false;
		}
                var ymd = /(\d{4})[^\d](\d{1,2})[^\d](\d{1,2})/;
                var result = data.sqriqi.match(ymd);
                if(!result){
                    alert("申请日期的格式是：2008-08-08.");
                    return false;
                }
//                else{
//                    data.sqriqi = result[1] + "-" + result[2] + "-" +result[3];
//                    alert(data.sqriqi);
//                }

                result = data.cfshijian.match(ymd);
                if(!result){
                    alert("出访日期的格式是：2008-08-08.");
                    return false;
                }
//                else{
//                    data.cfshijian = result[1] + "-" + result[2] + "-" +result[3];
//                }

                //save new staff.
                 var activity = new fao.classes.Activity(this.getData());
                 if(data.id)
                     activity.update();
                 else
                     activity.save();
                 fao.variables.activities_datatable.datasource.sendRequest('', fao.variables.activities_datatable.datatable.onDataReturnInitializeTable, fao.variables.activities_datatable.datatable);
                 return true;
            }
            catch(e){
                alert(e.message);
                return false;
            }
	};

	// Wire up the success and failure handlers
	this.dialog.callback = { success: handleSuccess,
						     failure: handleFailure };

	// Render the Dialog
	this.dialog.render();
//        alert(fao.addStaffDialog.cfg.getProperty("postmethod"));
	Event.addListener("addActivityBtn", "click", this.dialog.show, this.dialog, true);
//	Event.addListener("hide", "click", fao.addStaffDialog.hide, fao.addStaffDialog, true);
}
//Event.onDOMReady(init_dialog_activity);
</script>

<script type="text/javascript">
  fao.classes.AutoComp = function(){
    var textboxKeyHandler = function(sType,oArgs){
//        alert(oArgs[1]);
      if(!fao.doms.ac_input.value && (oArgs[1] == 8 || oArgs[1] == 46)){
          if(fao.variables.cur_table == 1)
              fao.variables.staffs_datatable.datasource.sendRequest('', fao.variables.staffs_datatable.datatable.onDataReturnInitializeTable, fao.variables.staffs_datatable.datatable);
          else
              fao.variables.activities_datatable.datasource.sendRequest('',fao.variables.activities_datatable.datatable.onDataReturnInitializeTable, fao.variables.activities_datatable.datatable);
//            alert("i'm empty");
      }
    }
    var getResults = function(query) {
//        alert(arguments.length);
//        alert(arguments[0]);
      if(fao.variables.cur_table == 1){
          fao.variables.staffs_datatable.datasource.sendRequest('', fao.variables.staffs_datatable.datatable.onDataReturnInitializeTable, fao.variables.staffs_datatable.datatable);
      }
      else{
          fao.variables.activities_datatable.datasource.sendRequest('',fao.variables.activities_datatable.datatable.onDataReturnInitializeTable, fao.variables.activities_datatable.datatable);
      }
    };
    var oACDS = new YAHOO.widget.DS_JSFunction(getResults);
//    oACDS.queryMatchContains = true;
    var oAutoComp = new YAHOO.widget.AutoComplete("ac_input","dt_ac_container", oACDS);
    oAutoComp.textboxKeyEvent.subscribe(textboxKeyHandler);
  }
</script>

<script type="text/javascript">
  fao.classes.StaffsDataTable = function(){
    this.datasource = null;
    this.datatable = null;
//    this.initializeTable = function( sRequest , oResponse , oPayload ){
//        this.datatable.onDataReturnInitializeTable(sRequest , oResponse , oPayload);
//        var fte = this.datatable.getFirstTrEl();
//        while(fte){
//            new YAHOO.util.DDProxy(fte);
//            fte = this.datatable.getNextTrEl(fte);
//        }
//    }
    var columnDefs = [
        {key:"name",label:"名字",sortable:true},
        {key:"danwei",label:"单位"},
        {key:"zhiwu",label:"职务"},
        {key:"hzhaoma",label:"护照"},
        {key:"pyname",label:"名字拼音"},
        {key:"spyname",label:"名字首拼音"},
        {key:"age",label:"年龄"},
        {key:"sex",label:"性别"},
        {key:"birthday",label:"出生日期",formatter:fao.utils.formatDate},
        {key:"note",label:"备注"},
        {key:"id",label:"删除",formatter:fao.utils.formatDeleteButton}
    ];
    var dsfunc= function(condi){
      var offset = condi ? (condi.offset || 0) : 0;
      var rowspp = condi ? (condi.rowspp || 4) : 4;
      var phrase = fao.doms.ac_input.value + "%";
      var sqlstmt = 'select * from staffs where name like ? or pyname like ? or spyname like ? order by created_at desc limit ? offset ?';
      var rs = fao.variables.db.execute(sqlstmt,[phrase,phrase,phrase,rowspp,offset]);
      var results = {staffs:[]};
      while(rs.isValidRow()) {
        results.staffs.push({
            id:rs.fieldByName("id"),
            name:rs.fieldByName("name"),
            danwei:rs.fieldByName("danwei"),
            zhiwu:rs.fieldByName("zhiwu"),
            hzhaoma:rs.fieldByName("hzhaoma"),
            hzghriqi:rs.fieldByName("hzghriqi"),
            pyname:rs.fieldByName("pyname"),
            spyname:rs.fieldByName("spyname"),
            sex:rs.fieldByName("sex"),
            birthday:new Date(rs.fieldByName("birthday")),
            note:rs.fieldByName("note"),
            sync_state:rs.fieldByName("sync_state"),
            age : fao.utils.convertAge(rs.fieldByName("birthday"))
        });
        rs.next();
      }
      rs.close();
      var count = 0;
      rs = fao.variables.db.execute("select count(*) from staffs where name like ? or pyname like ? or spyname like ?",[phrase,phrase,phrase]);
      if(rs.isValidRow())count = rs.field(0);
      rs.close();
//          alert(count);
      results.totalRecords = count;
//      alert("num:" + results.staffs.length);
      return results;
    };

//    try{
//        dsfunc();
//    }
//    catch(e){
//        alert(e.message);
//    }

    this.datasource = new YAHOO.util.DataSource(dsfunc);
    this.datasource.responseType = YAHOO.util.DataSource.TYPE_JSON;
    this.datasource.responseSchema = {
        resultsList : 'staffs',
        fields: [
            "id",
            "name",
            "danwei",
            "zhiwu",
            "hzhaoma",
            "hzghriqi",
            "pyname",
            "spyname",
            "sex",
            "birthday",
            "note",
            "age",
            "sync_state"
        ],
        metaFields :{totalRecords:"totalRecords"}
    };

    var buildQueryString = function(state,dt){
//            alert("paged");
        var offset = state.pagination.recordOffset;
        var rowspp = state.pagination.rowsPerPage;
        return {offset:offset,rowspp:rowspp};
    };
    var dataTableConfig = {
        initialRequest:"",
        paginator: new YAHOO.widget.Paginator({
            rowsPerPage:4
        }),
        generateRequest : buildQueryString,
        paginationEventHandler : YAHOO.widget.DataTable.handleDataSourcePagination
//            paginationEventHandler : YAHOO.widget.DataTable.handleSimplePagination
    };

    this.datatable = new YAHOO.widget.DataTable("staffDataTable", columnDefs,
        this.datasource, dataTableConfig);

//    this.datatable.set("selectionMode","single");
//    this.datatable.selectRow(this.datatable.getTrEl(0));

    var onRowMouseDown = function(oArgs){
        var targetRow = oArgs.target;
        var dd2 = new YAHOO.util.DDProxy(this.getTrEl(targetRow));
        targetRow.handleMouseDown(oArgs.event);
//        alert("ya");
    }

//    var onRender = function(oArgs){
//        alert("ya!");
//    }
//    //context is datatable self.
    var onRowDblClick = function(oArgs){
//        alert("dbl");
        try{
          var targetRow = oArgs.target;
          var targetRecordData = this.getRecord(targetRow).getData();
//          alert(targetRecordData.birthday);
          fao.variables.dialog_staff.setData(targetRecordData);
          fao.variables.dialog_staff.setButtons();
//          var buttons = fao.variables.dialog_staff.dialog.cfg.setProperty("buttons",
//      [{ text:"添加", handler:handleSubmit, isDefault:true }, {text:"取消", handler:handleCancel }]);

          fao.variables.dialog_staff.dialog.show();
        }catch(e){
            alert(e.message);
        }
    }
    //context is datatable self.
    var onRowClick = function(oArgs){
        this.onEventSelectRow(oArgs);
//        alert(m3958.utils.DisplayPropertyNames(oArgs));
//        alert(Event.getTarget(oArgs.event).tagName + "kkk");
        
        var targetRow = oArgs.target;
        var targetRecordDate = this.getRecord(targetRow).getData();
//        alert(m3958.utils.DisplayPropertyNames(targetRow));
//        alert(m3958.utils.DisplayPropertyNames(this.getTrEl(targetRow)));
        if(targetRow.isDD){
//            alert("already dd");
        }
        else{
            var ddRow = new YAHOO.util.DDProxy(targetRow);
            ddRow.onDragOver = function() {
//                Dom.addClass(arguments[1], 'over');
//                if (overLi && (overLi != arguments[1])) {
//                    Dom.removeClass(overLi, 'over');
//                }
//                overLi = arguments[1];
            }

            ddRow.onDragOut = function() {
//                Dom.removeClass(overLi, 'over');
            }

            ddRow.onDragDrop = function(ev) {
//                alert(ev.type);
//                alert(Event.getTarget(ev));
//                alert(m3958.utils.DisplayPropertyNames(ev));
                YAHOO.util.DragDropMgr.stopDrag(ev,true);
                Dom.get(this.getDragEl()).style.visibility = 'hidden';
                var selectedRowIds = fao.variables.staffs_datatable.datatable.getSelectedRows();
                for(var i =0;i<selectedRowIds.length;i++){
                    var staff = fao.variables.staffs_datatable.datatable.getRecord(selectedRowIds[i]).getData();
                    var staffd = new fao.classes.Staffd({
                        staff_id : staff.id,
                        activity_id :fao.variables.activity_id,
                        danwei : staff.danwei,
                        zhiwu : staff.zhiwu,
                        hzhaoma : staff.hzhaoma,
                        hzghriqi : staff.hzghriqi,
                        note : ""
                    });
                    try{
                        staffd.save();
                    }
                    catch(e){
                        alert(e.message);
                        alert(staff.name + "已经在列表中！");
                    }
                }
                fao.variables.staffds_datatable.datasource.sendRequest('', fao.variables.staffds_datatable.datatable.onDataReturnInitializeTable, fao.variables.staffds_datatable.datatable);
                fao.variables.staffds_datatable.datatable.render();
//                alert(fao.variables.staffs_datatable.datatable.getSelectedRows()[0]);
//                alert(fao.variables.staffs_datatable.datatable.getRecord(fao.variables.staffs_datatable.datatable.getSelectedRows()[0]).getData().id);
//                fao.variables.staffs_datatable.datasource.sendRequest('', fao.variables.staffs_datatable.datatable.onDataReturnInitializeTable, fao.variables.staffs_datatable.datatable);
            }
            ddRow.onInvalidDrop = function(ev){
                YAHOO.util.DragDropMgr.stopDrag(ev,true);
                Dom.get(this.getDragEl()).style.visibility = 'hidden';
            }


            targetRow.isDD = true;
        }
//        if(this.isSelected(targetRow)){
//            this.unselectRow(targetRow);
//        }
//        else{
//            this.selectRow(targetRow);
//        }
        var targetEl = Event.getTarget(oArgs.event);
        
//        alert(targetEl.id);
        if(targetEl.tagName.toUpperCase() == "BUTTON" && targetEl.innerHTML == "删除"){
            var answer =  confirm("真的要删除？");
//            alert(answer);
            if(answer){
                this.deleteRow(targetRow);
//                this.render();
                fao.variables.db.execute("delete from staffs where id = ?", [targetRecordData.id]);
            }
        }
    };
    this.datatable.subscribe('rowClickEvent', onRowClick,this.datatable,true);
    this.datatable.subscribe('rowDblclickEvent', onRowDblClick,this.datatable,true);
//    this.datatable.subscribe('rowMousedownEvent', onRowMouseDown,this.datatable,true);
//    this.datatable.subscribe('renderEvent', onRender,this.datatable,true);

//-------------------------------------------------------------------------------------------
  }
</script>

<script type="text/javascript">
  fao.classes.ActivitiesDataTable = function(){
      this.datasource = null;
      this.datatable = null;
      var columnDefs = [
          { key:"dguojia",label:"出访国家"},
          { key:"sqriqi",label:"申请日期",formatter:fao.utils.formatDate},
          {key:"renwu",label:"任务"},
          {key:"cfshijian",label:"出访时间",formatter:fao.utils.formatDate},
          {key:"tltianshu",label:"停留天数"},
          {key:"ztdanwei",label:"组团单位"},
          {key:"yqdanwei",label:"邀请单位"},
          {key:"rwpihao",label:"任务批号"},
          {key:"note",label:"备注"},
          {key:"id",label:"删除",formatter:fao.utils.formatDeleteButton},          
          {key:"id",label:"人员",formatter:fao.utils.formatStaffsButton}
      ];

        var dsfunc= function(condi){
//          alert("argument one:" + arguments[0]);
//          alert("staffsfunc is called!");
          var offset = condi ? (condi.offset || 0) : 0;
          var rowspp = condi ? (condi.rowspp || 4) : 4;
          var phrase = fao.doms.ac_input.value + "%";
          var sqlstmt = 'select * from activities where dguojia like ? order by created_at desc limit ? offset ?';
          var rs = fao.variables.db.execute(sqlstmt,[phrase,rowspp,offset]);
          var results = {activities:[]};
          while(rs.isValidRow()) {
            results.activities.push({
                id:rs.fieldByName("id"),
                sqriqi:new Date(rs.fieldByName("sqriqi")),
                dguojia:rs.fieldByName("dguojia"),
                renwu:rs.fieldByName("renwu"),
                cfshijian:new Date(rs.fieldByName("cfshijian")),
                tltianshu:rs.fieldByName("tltianshu"),
                ztdanwei:rs.fieldByName("ztdanwei"),
                yqdanwei:rs.fieldByName("yqdanwei"),
                rwpihao:rs.fieldByName("rwpihao"),
                note:rs.fieldByName("note"),
                sync_state:rs.fieldByName("sync_state")
            });
            rs.next();
          }
          rs.close();
          var count = 0;
          rs = fao.variables.db.execute("select count(*) from activities where dguojia like ?",[phrase]);
          if(rs.isValidRow())count = rs.field(0);
          rs.close();
//          alert(count);
          results.totalRecords = count;
          return results;
        };


        try{
            dsfunc();
        }
        catch(e){
            alert(e.message);
        }

        this.datasource = new YAHOO.util.DataSource(dsfunc);
        this.datasource.responseType = YAHOO.util.DataSource.TYPE_JSON;
        this.datasource.responseSchema = {
            resultsList:'activities',
            fields: [
                "id",
                "sqriqi",
                "dguojia",
                "renwu",
                "cfshijian",
                "tltianshu",
                "ztdanwei",
                "yqdanwei",
                "rwpihao",
                "note",
                "sync_state"
            ],
            metaFields :{totalRecords:"totalRecords"}
        };

        var buildQueryString = function(state,dt){
//            alert("paged");
            return {offset:state.pagination.recordOffset,rowspp:state.pagination.rowsPerPage};
        };

        var dataTableConfig = {
            initialRequest:"",
            paginator: new YAHOO.widget.Paginator({
                rowsPerPage:4
            }),
            generateRequest : buildQueryString,
            paginationEventHandler : YAHOO.widget.DataTable.handleDataSourcePagination
//            paginationEventHandler : YAHOO.widget.DataTable.handleSimplePagination
        };

        this.datatable = new YAHOO.widget.DataTable("ActivityDataTable", columnDefs,
            this.datasource, dataTableConfig);
        this.datatable.set("selectionMode","single");

    var onRowDblClick = function(oArgs){
//        alert("dbl");
        try{
          var targetRow = oArgs.target;
          var targetRecordData = this.getRecord(targetRow).getData();
//          alert(targetRecordData.birthday);
          fao.variables.dialog_activity.setData(targetRecordData);
          fao.variables.dialog_activity.setButtons();
//          var buttons = fao.variables.dialog_staff.dialog.cfg.setProperty("buttons",
//      [{ text:"添加", handler:handleSubmit, isDefault:true }, {text:"取消", handler:handleCancel }]);

          fao.variables.dialog_activity.dialog.show();
        }catch(e){
            alert(e.message);
        }
    }


//        this.datatable.selectRow(this.datatable.getTrEl(0));
    var onRowClick = function(oArgs){
//        alert(m3958.utils.DisplayPropertyNames(oArgs));
//        alert(Event.getTarget(oArgs.event).tagName + "kkk");
        this.onEventSelectRow(oArgs);
        var targetRow = oArgs.target;
        var targetRecordData = this.getRecord(targetRow).getData();
//        alert(targetRecord);
//        alert(targetRow.id);
        var targetEl = Event.getTarget(oArgs.event);
//        alert(targetEl.id);
        if(targetEl.tagName.toUpperCase() == "BUTTON"){
            if(targetEl.innerHTML == "删除"){
              var answer =  confirm("真的要删除？");
  //            alert(answer);
              if(answer){
                  this.deleteRow(targetRow);
                  fao.variables.db.execute("delete from activities where id = ?", [targetRecordData.id]);
              }
            }
            else if(targetEl.innerHTML == "人员"){
//                alert(targetRecordData.id);
                fao.variables.activity_id = targetRecordData.id;
                fao.doms.staff_radio.click();
                fao.variables.staffds_datatable.datasource.sendRequest('', fao.variables.staffds_datatable.datatable.onDataReturnInitializeTable, fao.variables.staffds_datatable.datatable);
                fao.doms.staff_panel_tab.style.display = "block";
                fao.variables.staff_panel.panel.show();
            }
            else{

            }
        }

//        alert("htmlid:" + oArgs.target.id);
//        alert("yuiRecordId:"+oArgs.target.yuiRecordId);
//        alert("recordindex:"+this.datatable.getRecordIndex(0));
        };
        this.datatable.subscribe('rowClickEvent', onRowClick,this.datatable,true);
        this.datatable.subscribe('rowDblclickEvent', onRowDblClick,this.datatable,true);
  }
</script>

<script type="text/javascript">
  fao.classes.StaffdsDataTable = function(){
    this.datasource = null;
    this.datatable = null;
    var columnDefs = [
        { key:"name",sortable:true,label:"姓名"},
        { key:"danwei",label:"单位"},
        {key:"zhiwu",label:"职务"},
        {key:"hzhaoma",label:"护照号码"},
        {key:"hzghriqi",label:"归还日期",formatter:fao.utils.formatDate},
        {key:"isreturned",label:"护照归还",formatter:"checkbox"},
        {key:"note",label:"备注"},
        {key:"id",label:"删除",formatter:fao.utils.formatDeleteButton}
    ];
    var dsfunc= function(condi){
//          alert("argument one:" + arguments[0]);
//          alert("staffdsfunc is called!");
          var offset = condi ? (condi.offset || 0) : 0;
          var rowspp = condi ? (condi.rowspp || 4) : 4;
//          var phrase = fao.doms.ac_input.value + "%";
          var activity_id = fao.variables.activity_id;
          var sqlstmt = 'select * from staffds where activity_id = ? order by created_at desc limit ? offset ?';
          var rs = fao.variables.db.execute(sqlstmt,[activity_id,rowspp,offset]);
          var results = {staffds:[]};
          while(rs.isValidRow()) {
            var staffname = null;
            var rs1 = fao.variables.db.execute("select name from staffs where id = ?",[rs.fieldByName("staff_id")]);
            if(rs1.isValidRow()){
                staffname = rs1.field(0);
//                alert(staffname);
            }
            
//            alert(staffname);
            results.staffds.push({
                id:rs.fieldByName("id"),
                name : staffname,
                staff_id:rs.fieldByName("staff_id"),
                activity_id:rs.fieldByName("activity_id"),
                danwei:rs.fieldByName("danwei"),
                zhiwu:rs.fieldByName("zhiwu"),
                note:rs.fieldByName("note"),
                hzhaoma:rs.fieldByName("hzhaoma"),
                hzghriqi:new Date(rs.fieldByName("hzghriqi")),                
                note:rs.fieldByName("note"),
                sync_state:rs.fieldByName("sync_state")
            });
            rs.next();
          }
          rs.close();
          var count = 0;
          rs = fao.variables.db.execute("select count(*) from staffds where activity_id = ?",[activity_id]);
          if(rs.isValidRow())count = rs.field(0);
          rs.close();
//          alert(count);
          results.totalRecords = count;
          return results;
        };
        
      try{
            dsfunc();
        }
      catch(e){
            alert(e.message);
        }

        this.datasource = new YAHOO.util.DataSource(dsfunc);
        this.datasource.responseType = YAHOO.util.DataSource.TYPE_JSON;
        this.datasource.responseSchema = {
            resultsList : 'staffds',
            fields: [
                "id",
                "name",
                "staff_id",
                "activity_id",
                "danwei",
                "zhiwu",
                "hzhaoma",
                "hzghriqi",
                "note",
                "sync_state"
            ],
            metaFields :{totalRecords:"totalRecords"}
        };

        var buildQueryString = function(state,dt){
            alert("paged");
            return {offset:state.pagination.recordOffset,rowspp:state.pagination.rowsPerPage};
        };
        var dataTableConfig = {
            initialRequest:"",
            paginator: new YAHOO.widget.Paginator({
                rowsPerPage:4
            }),
            generateRequest : buildQueryString,
            paginationEventHandler : YAHOO.widget.DataTable.handleDataSourcePagination
//            paginationEventHandler : YAHOO.widget.DataTable.handleSimplePagination
        };

        this.datatable = new YAHOO.widget.DataTable("staffdDataTable", columnDefs,
            this.datasource, dataTableConfig);

        this.datatable.set("selectionMode","single");
//        this.datatable.selectRow(this.datatable.getTrEl(0));

    var onRowDblClick = function(oArgs){
        
//        alert("dbl");
        try{
          var targetRow = oArgs.target;
          var targetRecordData = this.getRecord(targetRow).getData();
          
//          alert(targetRecordData.birthday);
          fao.variables.dialog_staffd.setData(targetRecordData);
          fao.variables.dialog_staffd.setButtons();
//          var buttons = fao.variables.dialog_staff.dialog.cfg.setProperty("buttons",
//      [{ text:"添加", handler:handleSubmit, isDefault:true }, {text:"取消", handler:handleCancel }]);

          fao.variables.dialog_staffd.dialog.show();
        }catch(e){
            alert(e.message);
        }
    }


//        this.datatable.selectRow(this.datatable.getTrEl(0));
    var onRowClick = function(oArgs){
        this.onEventSelectRow(oArgs);
//        alert(m3958.utils.DisplayPropertyNames(oArgs));
//        alert(Event.getTarget(oArgs.event).tagName + "kkk");

        var targetRow = oArgs.target;
        var targetRecordData = this.getRecord(targetRow).getData();
//        alert(targetRecord);
//        alert(targetRow.id);
        var targetEl = Event.getTarget(oArgs.event);
//        alert(targetEl.id);
        if(targetEl.tagName.toUpperCase() == "BUTTON"){
            if(targetEl.innerHTML == "删除"){
              var answer =  confirm("真的要删除？");
  //            alert(answer);
              if(answer){
                  this.deleteRow(targetRow);
                  fao.variables.db.execute("delete from staffds where id = ?", [targetRecordData.id]);
              }
            }
            else if(targetEl.innerHTML == "人员"){
//                alert(targetRecordData.id);
                fao.variables.activity_id = targetRecordData.id;
                fao.doms.staff_radio.click();
                fao.variables.staffds_datatable.datasource.sendRequest('', fao.variables.staffds_datatable.datatable.onDataReturnInitializeTable, fao.variables.staffds_datatable.datatable);
                fao.doms.staff_panel_tab.style.display = "block";
                fao.variables.staff_panel.panel.show();
            }
            else{

            }
        }

//        alert("htmlid:" + oArgs.target.id);
//        alert("yuiRecordId:"+oArgs.target.yuiRecordId);
//        alert("recordindex:"+this.datatable.getRecordIndex(0));
        };
        this.datatable.subscribe('rowClickEvent', onRowClick,this.datatable,true);
        this.datatable.subscribe('rowDblclickEvent', onRowDblClick,this.datatable,true);        
  }
//-------------------------------------------------------------------------------------------
</script>


<!--
<div id="radiogroup1" class="yui-buttongroup">
    <input id="staff_radio" type="radio" name="radiofield1" value="1" checked>人员查询
    <input id="activity_radio" type="radio" name="radiofield1" value="2">出访查询
</div>
-->

<script type="text/javascript">

//  var oButtonGroup1 = new YAHOO.widget.ButtonGroup("radiogroup1");

  fao.f.event_handlers = function(){
    var staff_radio_handler = function(ev){
      if(fao.variables.cur_table == 1){
          return;
      }
      else{
        fao.variables.pre_activity_phase = fao.doms.ac_input.value;
        fao.doms.ac_input.value = fao.variables.pre_staff_phase;
//        alert(fao.variables.staffs_datatable.datatable.get("paginator").getCurrentPage());
//        fao.variables.pre_activity_page = fao.variables.activities_datatable.datatable.get("paginator").getCurrentPage();
        fao.variables.cur_table = 1;  
        fao.doms.activity_tab.style.display="none";
        fao.doms.staff_tab.style.display="block";
//        alert("aa" + fao.variables.staffs_datatable.datatable.get("paginator").get("recordOffset"));
        var condi = {
            offset:fao.variables.staffs_datatable.datatable.get("paginator").get("recordOffset"),
            rowspp:fao.variables.staffs_datatable.datatable.get("paginator").get("rowsPerPage")
        }
        fao.variables.staffs_datatable.datatable.get("paginator").setPage(fao.variables.staffs_datatable.datatable.get("paginator").getCurrentPage());
//        fao.variables.staffs_datatable.datasource.sendRequest(condi, fao.variables.staffs_datatable.datatable.onDataReturnInitializeTable, fao.variables.staffs_datatable.datatable);
      }
    };
    Event.addListener(fao.doms.staff_radio,"click",staff_radio_handler);
    
    var activity_radio_handler = function(ev){
      try{
        if(fao.variables.cur_table == 2){
            return;
        }
        else{
          fao.variables.pre_staff_phase = fao.doms.ac_input.value;
          fao.doms.ac_input.value = fao.variables.pre_activity_phase;
//          fao.variables.pre_staff_page = fao.variables.staffs_datatable.datatable.get("paginator").getCurrentPage();
          fao.variables.cur_table = 2;
          fao.doms.activity_tab.style.display="block";
          fao.doms.staff_tab.style.display="none";
          fao.variables.activities_datatable.datatable.get("paginator").setPage(fao.variables.activities_datatable.datatable.get("paginator").getCurrentPage(),false);
          fao.variables.activities_datatable.datatable.render();
//          fao.variables.activities_datatable.datasource.sendRequest('', fao.variables.activities_datatable.datatable.onDataReturnInitializeTable, fao.variables.activities_datatable.datatable);
        }
      }
      catch(e){
          alert(e.message);
      }
    };
    Event.addListener(fao.doms.activity_radio,"click",activity_radio_handler);
  };
</script>



<script>
      fao.classes.StaffPanel = function(){
              this.panel = new YAHOO.widget.Panel("staff_panel", { visible:false,
                                                                    constraintoviewport: true,
                                                                    close:true,
                                                                    draggable:true,
                                                                    context:["staffDataTable","tl","tr"]});
                                                                //context,then panel's corner,then context corner.
              this.panel.render("staff_panel_container");
              var staffdHideHandler = function(){
                  fao.doms.staff_panel_tab.style.display = "none";
                  fao.doms.activity_radio.click();
              }
              this.panel.hideEvent.subscribe(staffdHideHandler);
//              alert(Dom.getXY("staff_panel_container"));
//              Dom.setXY("staff_panel_container",[0,0]);
//              Event.addListener("show2", "click", this.panel.show, this.panel, true);
//              Event.addListener("hide2", "click", this.panel.hide, this.panel, true);
      };

</script>
<script type="text/javascript">
//  fao.f.datatable_listeners = function(){
//    var staff_dt_handler = function(e,obj){
//          m3958.utils.DisplayPropertyNames(e);
//      var targetEl = Event.getTarget(e);
//      if(targetEl.tagName.toUpperCase() == "BUTTON" && targetEl.innerHTML == "删除"){
//          alert("i will delete it!");
//      }
//    }
//    Event.addListener("staffDataTable","click",staff_dt_handler);
//  }
</script>
<!--event listener-->
<script type="text/javascript">
//    YAHOO.util.Event.addListener("myelementid", "click", fnCallback2, mydata, myobj);
//events usage. fncallback get two arguments:event object,mydata.
    function faoinit(){
        try{
          fao.f.my_gear_init();
          fao.variables.dialog_staff = new fao.classes.DialogStaff();
          fao.variables.dialog_activity = new fao.classes.DialogActivity();
          fao.variables.dialog_staffd = new fao.classes.DialogStaffd();
          fao.variables.auto_comp = new fao.classes.AutoComp();
          fao.variables.staffs_datatable = new fao.classes.StaffsDataTable();
          fao.variables.activities_datatable = new fao.classes.ActivitiesDataTable();
          fao.variables.staffds_datatable = new fao.classes.StaffdsDataTable();
          fao.variables.staff_panel = new fao.classes.StaffPanel();
          fao.doms.staff_panel_tab.style.display = "none";
//          Dom.get("ActivityDataTable").style.display = "none";
          //because activity_id is null at init,so staffd_datatable are empty.
          fao.f.event_handlers();
          fao.doms.ac_input.focus();
//          fao.f.datatable_listeners();
          new YAHOO.util.DDTarget("staff_panel");
          var testFunc = function(){
//              m3958.utils.DisplayPropertyNames(fao.variables.staffs_datatable.datatable.get("paginator"));
//              alert(fao.variables.staffs_datatable.datatable.get("paginator"));
            fao.variables.staffs_datatable.datatable.get("paginator").setPage(2);
          };
          Event.addListener("test_button","click",testFunc);
        }
        catch(e){
            alert(e);
            alert(e.message);
        }
    }

if (!window.google || !window.google.gears) {
    var message = '要使用本系统需要安装来自Google的Gears ';
    var url = 'http://gears.google.com/?action=install'
        + '&message=' + encodeURIComponent(message)
        + '&return=' + encodeURIComponent(window.location.href);
    var g_message = innerHTML = '<a href="' + url + '">本系统需要安装Google Gears： '
        + '开始安装!</a>';

    var g_panel = new YAHOO.widget.Panel("g_panel", { width:"320px", visible:true, constraintoviewport:true } );
        g_panel.setHeader("需要安装");
        g_panel.setBody(g_message);
        g_panel.render(document.body);
}
else{
    Event.onDOMReady(faoinit);
}
</script>
<!--grid div -->
	</div>
</div>

  <div id="ft">
    <br/><br/>
  奉化市政府外事办管理系统
  </div>
</div>

<!--END SOURCE CODE FOR EXAMPLE =============================== -->
<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>

申请日期
姓名
年龄
性别
单位
职务
出访国家
出访任务
出访时间
停留天数
组团单位
邀请单位
任务批件号
护照号码
护照归还日期

---starttest---

<script type="text/javascript">

    YAHOO.namespace("example.yuitest");

    YAHOO.example.yuitest.regexTestCase = new YAHOO.tool.TestCase({
    name : "Regex Tests",
    setUp : function(){
        this.data = "2008+09-01";
    },

    tearDown: function(){
        delete this.data;
    },

    testMatch: function(){
        var str = "20082008-01-01";
        var re = /\d{4}[^\d]\d{1,2}[^\d]\d{1,2}/;
         var Assert = YAHOO.util.Assert;
         var result = str.match(re);
         Assert.areEqual(1,result.length);
         Assert.areEqual("2008-01-01",result[0]);
    },
    testCr:function(){
        var str = "a\rb";
        var re=/\r\n+|\r+|\n+/
        //if re has (),then return string will include delimiters.
        var result = str.split(re);
        var Assert = YAHOO.util.Assert;
        Assert.isArray(result);
        Assert.areEqual(2,result.length);
        Assert.areEqual("a",result[0]);
        Assert.areEqual("b",result[1]);
    },

    testStrip:function(){
      var str = "a isk dlskks aa";
      var s = "a";
      var re=new RegExp("^" + s + "*(.*?)" + s + "*$");
      var astr = str.replace(re, "$1");
      var Assert = YAHOO.util.Assert;
      Assert.areEqual(" isk dlskks ",astr);
    },

    testParams:function(){
        var f=function(s){
            return s;
        };
      var r = f();
      var Assert = YAHOO.util.Assert;
      Assert.isUndefined(r);
      var str = "aa bb aa";
      Assert.areEqual(" bb ",str.strip("a"));
    },
    testSplit: function(){
        var str = "abc,usk\r\n中国或,isks\r美国 ,试试哦打开\n思考is,sisks\r";
        var re=/\r+\n+|\r+|\n+/m
        var result = str.split(re);
        var Assert = YAHOO.util.Assert;
        Assert.isArray(result);
        Assert.areEqual(5,result.length);
        Assert.areEqual("",result[result.length-1]);
        Assert.areEqual("abc,usk",result[0]);
    },
    testDate:function(){
        var aday = new Date();
        aday.setMonth(11,11);
        aday.setHours(11, 30, 30, 300);
        var Assert = YAHOO.util.Assert;
        Assert.areEqual(11,aday.getHours());
        Assert.areEqual(3,aday.getUTCHours());
    }
    });


    YAHOO.example.yuitest.DataTestCase = new YAHOO.tool.TestCase({

        //name of the test case - if not provided, one is auto-generated
        name : "Data Tests",

        //---------------------------------------------------------------------
        // setUp and tearDown methods - optional
        //---------------------------------------------------------------------

        /*
         * Sets up data that is needed by each test.
         */
        setUp : function () {
            this.data = {
                name: "yuitest",
                year: 2007,
                beta: true
            };
        },

        /*
         * Cleans up everything that was created by setUp().
         */
        tearDown : function () {
            delete this.data;
        },

        //---------------------------------------------------------------------
        // Test methods - names must begin with "test"
        //---------------------------------------------------------------------

        testName : function () {
            var Assert = YAHOO.util.Assert;

            Assert.isObject(this.data);
            Assert.isString(this.data.name);
            Assert.areEqual("yuitest", this.data.name);
        },

        testYear : function () {
            var Assert = YAHOO.util.Assert;

            Assert.isObject(this.data);
            Assert.isNumber(this.data.year);
            Assert.areEqual(2007, this.data.year);
        },

        testBeta : function () {
            var Assert = YAHOO.util.Assert;

            Assert.isObject(this.data);
            Assert.isBoolean(this.data.beta);
            Assert.isTrue(this.data.beta);
        }

    });

    YAHOO.example.yuitest.ArrayTestCase = new YAHOO.tool.TestCase({

        //name of the test case - if not provided, one is auto-generated
        name : "Array Tests",

        //---------------------------------------------------------------------
        // setUp and tearDown methods - optional
        //---------------------------------------------------------------------

        /*
         * Sets up data that is needed by each test.
         */
        setUp : function () {
            this.data = [0,1,2,3,4]
        },

        /*
         * Cleans up everything that was created by setUp().
         */
        tearDown : function () {
            delete this.data;
        },

        //---------------------------------------------------------------------
        // Test methods - names must begin with "test"
        //---------------------------------------------------------------------

        testPop : function () {
            var Assert = YAHOO.util.Assert;

            var value = this.data.pop();

            Assert.areEqual(4, this.data.length);
            Assert.areEqual(4, value);
        },

        testPush : function () {
            var Assert = YAHOO.util.Assert;

            this.data.push(5);

            Assert.areEqual(6, this.data.length);
            Assert.areEqual(5, this.data[5]);
        },

        testSplice : function () {
            var Assert = YAHOO.util.Assert;

            this.data.splice(2, 1, 6, 7);

            Assert.areEqual(6, this.data.length);
            Assert.areEqual(6, this.data[2]);
            Assert.areEqual(7, this.data[3]);
        }

    });

    YAHOO.example.yuitest.ExampleSuite = new YAHOO.tool.TestSuite("Example Suite");
    YAHOO.example.yuitest.ExampleSuite.add(YAHOO.example.yuitest.DataTestCase);
    YAHOO.example.yuitest.ExampleSuite.add(YAHOO.example.yuitest.ArrayTestCase);
    YAHOO.example.yuitest.ExampleSuite.add(YAHOO.example.yuitest.regexTestCase);

    Event.onDOMReady(function (){
        //create the logger
        var logger = new YAHOO.tool.TestLogger("testLogger");
        YAHOO.tool.TestRunner.add(YAHOO.example.yuitest.ExampleSuite);

        //run the tests
        YAHOO.tool.TestRunner.run();
    });
</script>
<div id="testLogger"></div>

 </body>
</html>
